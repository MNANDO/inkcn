{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "editor",
  "title": "Editor",
  "description": "A Notion style rich text editor created with Lexical.",
  "dependencies": [
    "lexical",
    "@lexical/react",
    "@lexical/extension"
  ],
  "registryDependencies": [
    "toggle-group",
    "button",
    "dropdown-menu"
  ],
  "files": [
    {
      "path": "registry/blocks/editor.tsx",
      "content": "'use client';\n\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport { LexicalErrorBoundary } from '@lexical/react/LexicalErrorBoundary';\nimport { LexicalExtensionComposer } from '@lexical/react/LexicalExtensionComposer';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { type AnyLexicalExtension } from 'lexical';\nimport { ReactNode, useState } from 'react';\nimport EditorToolbarPlugin from '../components/editor-toolbar-plugin';\nimport EditorBlockControlPlugin from '../components/editor-block-control-plugin';\n\nexport function Editor({\n\tlexicalExtension,\n\tclassName,\n\tplaceholder,\n\tshowBlockHandle = true,\n\tshowToolbar = true,\n\t// onChange,\n\tchildren,\n}: {\n\tlexicalExtension: AnyLexicalExtension;\n\tclassName?: string;\n\tplaceholder?: string;\n\tshowBlockHandle?: boolean;\n\tshowToolbar?: boolean;\n\t// onChange?: (\n\t// \teditorState: EditorState,\n\t// \teditor: LexicalEditor,\n\t// \ttags: Set<string>,\n\t// ) => void;\n\tchildren?: ReactNode;\n}) {\n\tconst [floatingAnchorElem, setFloatingAnchorElem] =\n\t\tuseState<HTMLDivElement | null>(null);\n\n\tconst onRef = (_floatingAnchorElem: HTMLDivElement) => {\n\t\tif (_floatingAnchorElem !== null) {\n\t\t\tsetFloatingAnchorElem(_floatingAnchorElem);\n\t\t}\n\t};\n\n\tconst editorPlaceholder =\n\t\tplaceholder ?? \"Enter some text or type '/' for commands\";\n\n\treturn (\n\t\t<LexicalExtensionComposer\n\t\t\textension={lexicalExtension}\n\t\t\tcontentEditable={null}\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName={`relative font-normal leading-[1.7] text-black ${className ?? ''}`}\n\t\t\t>\n\t\t\t\t<div className=\"relative block bg-white\">\n\t\t\t\t\t<RichTextPlugin\n\t\t\t\t\t\tcontentEditable={\n\t\t\t\t\t\t\t<div className=\"relative z-0 flex min-h-37.5 max-w-full resize-y border-0 outline-none\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tref={onRef}\n\t\t\t\t\t\t\t\t\tclassName=\"relative z-0 max-w-full flex-auto resize-y\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ContentEditable\n\t\t\t\t\t\t\t\t\t\tclassName={`relative min-h-37.5 resize-none px-2.5 py-3.75 text-[15px] caret-[#444] outline-none [tab-size:1] ${showBlockHandle ? 'ml-12' : ''}`}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={`pointer-events-none absolute top-3.75 inline-block select-none overflow-hidden text-ellipsis text-[15px] text-[#999] ${showBlockHandle ? 'left-14.5' : 'left-2.5'}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{editorPlaceholder}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tErrorBoundary={LexicalErrorBoundary}\n\t\t\t\t\t/>\n\t\t\t\t\t{floatingAnchorElem && showToolbar && (\n\t\t\t\t\t\t<EditorToolbarPlugin anchorElem={floatingAnchorElem} />\n\t\t\t\t\t)}\n\t\t\t\t\t{floatingAnchorElem && showBlockHandle && (\n\t\t\t\t\t\t<EditorBlockControlPlugin\n\t\t\t\t\t\t\tanchorElem={floatingAnchorElem}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{children}\n\t\t\t\t\t{/* {onChange && <OnChangePlugin onChange={onChange} />} */}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</LexicalExtensionComposer>\n\t);\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/components/editor-toolbar.tsx",
      "content": "import { mergeRegister } from '@lexical/utils';\nimport {\n\t$getSelection,\n\tCOMMAND_PRIORITY_LOW,\n\tFORMAT_TEXT_COMMAND,\n\tgetDOMSelection,\n\tLexicalEditor,\n\tSELECTION_CHANGE_COMMAND,\n\tTextFormatType,\n} from 'lexical';\nimport { JSX, useCallback, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nimport {\n\tBold,\n\tItalic,\n\tUnderline,\n\tStrikethrough,\n\tChevronDown,\n} from 'lucide-react';\n\nimport { getDOMRangeRect, setFloatingElemPosition } from '../lib/editor-utils';\nimport { ToggleGroup, ToggleGroupItem } from '@/components/ui/toggle-group';\nimport { useEditorToolbar } from '../hooks/use-editor-toolbar';\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuGroup,\n\tDropdownMenuItem,\n\tDropdownMenuLabel,\n\tDropdownMenuSeparator,\n\tDropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Button } from '@/components/ui/button';\n\nexport default function EditorToolbar({\n\teditor,\n\tanchorElem,\n}: {\n\teditor: LexicalEditor;\n\tanchorElem: HTMLElement;\n}): JSX.Element | null {\n\tconst state = useEditorToolbar(editor);\n\tconst popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n\n\tconst { isBold, isItalic, isUnderline, isStrikethrough } = state;\n\n\t// Callback ref to position toolbar immediately when element is created\n\tconst setPopupRef = useCallback(\n\t\t(elem: HTMLDivElement | null) => {\n\t\t\tpopupCharStylesEditorRef.current = elem;\n\t\t\tif (elem) {\n\t\t\t\t// Position immediately when ref is set\n\t\t\t\teditor.getEditorState().read(() => {\n\t\t\t\t\tconst selection = $getSelection();\n\t\t\t\t\tconst nativeSelection = getDOMSelection(editor._window);\n\t\t\t\t\tconst rootElement = editor.getRootElement();\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tselection !== null &&\n\t\t\t\t\t\tnativeSelection !== null &&\n\t\t\t\t\t\t!nativeSelection.isCollapsed &&\n\t\t\t\t\t\trootElement !== null &&\n\t\t\t\t\t\trootElement.contains(nativeSelection.anchorNode)\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst rangeRect = getDOMRangeRect(\n\t\t\t\t\t\t\tnativeSelection,\n\t\t\t\t\t\t\trootElement,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tsetFloatingElemPosition(\n\t\t\t\t\t\t\trangeRect,\n\t\t\t\t\t\t\telem,\n\t\t\t\t\t\t\tanchorElem,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t[editor, anchorElem],\n\t);\n\n\tfunction mouseMoveListener(e: MouseEvent) {\n\t\tif (\n\t\t\tpopupCharStylesEditorRef.current &&\n\t\t\t(e.buttons === 1 || e.buttons === 2)\n\t\t) {\n\t\t\tif (\n\t\t\t\tpopupCharStylesEditorRef.current.style.pointerEvents !== 'none'\n\t\t\t) {\n\t\t\t\tconst elementUnderMouse = document.elementFromPoint(\n\t\t\t\t\te.clientX,\n\t\t\t\t\te.clientY,\n\t\t\t\t);\n\t\t\t\tif (\n\t\t\t\t\telementUnderMouse &&\n\t\t\t\t\t!popupCharStylesEditorRef.current.contains(\n\t\t\t\t\t\telementUnderMouse,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tpopupCharStylesEditorRef.current.style.pointerEvents =\n\t\t\t\t\t\t'none';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction mouseUpListener() {\n\t\tif (!popupCharStylesEditorRef.current) return;\n\t\tif (popupCharStylesEditorRef.current.style.pointerEvents !== 'auto') {\n\t\t\tpopupCharStylesEditorRef.current.style.pointerEvents = 'auto';\n\t\t}\n\t}\n\n\tuseEffect(() => {\n\t\tif (!popupCharStylesEditorRef.current) return;\n\n\t\tdocument.addEventListener('mousemove', mouseMoveListener);\n\t\tdocument.addEventListener('mouseup', mouseUpListener);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('mousemove', mouseMoveListener);\n\t\t\tdocument.removeEventListener('mouseup', mouseUpListener);\n\t\t};\n\t}, []);\n\n\tconst $updateTextFormatEditorToolbar = useCallback(() => {\n\t\tconst selection = $getSelection();\n\t\tconst popupElem = popupCharStylesEditorRef.current;\n\t\tconst nativeSelection = getDOMSelection(editor._window);\n\n\t\tif (popupElem === null) return;\n\n\t\tconst rootElement = editor.getRootElement();\n\t\tif (\n\t\t\tselection !== null &&\n\t\t\tnativeSelection !== null &&\n\t\t\t!nativeSelection.isCollapsed &&\n\t\t\trootElement !== null &&\n\t\t\trootElement.contains(nativeSelection.anchorNode)\n\t\t) {\n\t\t\tconst rangeRect = getDOMRangeRect(nativeSelection, rootElement);\n\t\t\tsetFloatingElemPosition(rangeRect, popupElem, anchorElem, false);\n\t\t}\n\t}, [editor, anchorElem]);\n\n\tuseEffect(() => {\n\t\tconst scrollerElem = anchorElem.parentElement;\n\n\t\tconst update = () => {\n\t\t\teditor.getEditorState().read(() => {\n\t\t\t\t$updateTextFormatEditorToolbar();\n\t\t\t});\n\t\t};\n\n\t\twindow.addEventListener('resize', update);\n\t\tscrollerElem?.addEventListener('scroll', update);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('resize', update);\n\t\t\tscrollerElem?.removeEventListener('scroll', update);\n\t\t};\n\t}, [editor, $updateTextFormatEditorToolbar, anchorElem]);\n\n\tuseEffect(() => {\n\t\teditor.getEditorState().read(() => {\n\t\t\t$updateTextFormatEditorToolbar();\n\t\t});\n\n\t\treturn mergeRegister(\n\t\t\teditor.registerUpdateListener(({ editorState }) => {\n\t\t\t\teditorState.read(() => {\n\t\t\t\t\t$updateTextFormatEditorToolbar();\n\t\t\t\t});\n\t\t\t}),\n\t\t\teditor.registerCommand(\n\t\t\t\tSELECTION_CHANGE_COMMAND,\n\t\t\t\t() => {\n\t\t\t\t\t$updateTextFormatEditorToolbar();\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tCOMMAND_PRIORITY_LOW,\n\t\t\t),\n\t\t);\n\t}, [editor, $updateTextFormatEditorToolbar]);\n\n\tif (!state.isVisible) return null;\n\n\tconst clearSelection = () => {\n\t\twindow.getSelection()?.removeAllRanges();\n\t};\n\n\tconst handleValueChange = (values: string[]) => {\n\t\tconst formats: TextFormatType[] = [\n\t\t\t'bold',\n\t\t\t'italic',\n\t\t\t'underline',\n\t\t\t'strikethrough',\n\t\t];\n\t\tformats.forEach((format) => {\n\t\t\tconst isActive =\n\t\t\t\tformat === 'bold'\n\t\t\t\t\t? isBold\n\t\t\t\t\t: format === 'italic'\n\t\t\t\t\t\t? isItalic\n\t\t\t\t\t\t: format === 'underline'\n\t\t\t\t\t\t\t? isUnderline\n\t\t\t\t\t\t\t: isStrikethrough;\n\t\t\tconst shouldBeActive = values.includes(format);\n\t\t\tif (isActive !== shouldBeActive) {\n\t\t\t\teditor.dispatchCommand(FORMAT_TEXT_COMMAND, format);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn createPortal(\n\t\t<div\n\t\t\tref={setPopupRef}\n\t\t\tclassName=\"absolute z-50 flex items-center gap-0.5 rounded-md border bg-popover p-1 shadow-md animate-in fade-in-0 zoom-in-95 slide-in-from-bottom-2 duration-150\"\n\t\t>\n\t\t\t{editor.isEditable() && (\n\t\t\t\t<ToggleGroup\n\t\t\t\t\ttype=\"multiple\"\n\t\t\t\t\tspacing={1}\n\t\t\t\t\tvalue={[\n\t\t\t\t\t\t...(isBold ? ['bold'] : []),\n\t\t\t\t\t\t...(isItalic ? ['italic'] : []),\n\t\t\t\t\t\t...(isUnderline ? ['underline'] : []),\n\t\t\t\t\t\t...(isStrikethrough ? ['strikethrough'] : []),\n\t\t\t\t\t]}\n\t\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\t>\n\t\t\t\t\t<ToggleGroupItem\n\t\t\t\t\t\tvalue=\"bold\"\n\t\t\t\t\t\ttitle=\"Bold\"\n\t\t\t\t\t\taria-label=\"Format text as bold\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Bold className=\"h-2 w-2\" />\n\t\t\t\t\t</ToggleGroupItem>\n\n\t\t\t\t\t<ToggleGroupItem\n\t\t\t\t\t\tvalue=\"italic\"\n\t\t\t\t\t\ttitle=\"Italic\"\n\t\t\t\t\t\taria-label=\"Format text as italics\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Italic className=\"h-2 w-2\" />\n\t\t\t\t\t</ToggleGroupItem>\n\n\t\t\t\t\t<ToggleGroupItem\n\t\t\t\t\t\tvalue=\"underline\"\n\t\t\t\t\t\ttitle=\"Underline\"\n\t\t\t\t\t\taria-label=\"Format text to underlined\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Underline className=\"h-2 w-2\" />\n\t\t\t\t\t</ToggleGroupItem>\n\n\t\t\t\t\t<ToggleGroupItem\n\t\t\t\t\t\tvalue=\"strikethrough\"\n\t\t\t\t\t\ttitle=\"Strikethrough\"\n\t\t\t\t\t\taria-label=\"Format text with a strikethrough\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Strikethrough className=\"h-2 w-2\" />\n\t\t\t\t\t</ToggleGroupItem>\n\t\t\t\t</ToggleGroup>\n\t\t\t)}\n\t\t\t<DropdownMenu>\n\t\t\t\t<DropdownMenuTrigger asChild>\n\t\t\t\t\t<Button variant=\"outline\">\n\t\t\t\t\t\tOpen <ChevronDown />\n\t\t\t\t\t</Button>\n\t\t\t\t</DropdownMenuTrigger>\n\t\t\t\t<DropdownMenuContent>\n\t\t\t\t\t<DropdownMenuGroup>\n\t\t\t\t\t\t<DropdownMenuLabel>My Account</DropdownMenuLabel>\n\t\t\t\t\t\t<DropdownMenuItem onSelect={clearSelection}>\n\t\t\t\t\t\t\tProfile\n\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t<DropdownMenuItem onSelect={clearSelection}>\n\t\t\t\t\t\t\tBilling\n\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t\t<DropdownMenuItem onSelect={clearSelection}>\n\t\t\t\t\t\t\tSettings\n\t\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t</DropdownMenuGroup>\n\t\t\t\t\t<DropdownMenuSeparator />\n\t\t\t\t\t<DropdownMenuItem onSelect={clearSelection}>\n\t\t\t\t\t\tGitHub\n\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t<DropdownMenuItem onSelect={clearSelection}>\n\t\t\t\t\t\tSupport\n\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t\t<DropdownMenuItem onSelect={clearSelection} disabled>\n\t\t\t\t\t\tAPI\n\t\t\t\t\t</DropdownMenuItem>\n\t\t\t\t</DropdownMenuContent>\n\t\t\t</DropdownMenu>\n\t\t</div>,\n\t\tanchorElem,\n\t);\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/components/editor-toolbar-plugin.tsx",
      "content": "import type { JSX } from 'react';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport Toolbar from '@/components/editor-toolbar';\n\nexport default function EditorToolbarPlugin({\n\tanchorElem = document.body,\n}: {\n\tanchorElem?: HTMLElement;\n}): JSX.Element | null {\n\tconst [editor] = useLexicalComposerContext();\n\treturn <Toolbar editor={editor} anchorElem={anchorElem} />;\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/components/editor-block-control-plugin.tsx",
      "content": "'use client';\n\nimport type { JSX } from 'react';\n\nimport { DraggableBlockPlugin_EXPERIMENTAL } from '@lexical/react/LexicalDraggableBlockPlugin';\nimport { useRef, useCallback } from 'react';\nimport { GripVertical, Plus } from 'lucide-react';\n\ntype BlockControlPluginProps = {\n\tanchorElem?: HTMLElement;\n};\n\nexport default function EditorBlockControlPlugin({\n\tanchorElem = document.body,\n}: BlockControlPluginProps): JSX.Element {\n\tconst menuRef = useRef<HTMLDivElement>(null);\n\tconst targetLineRef = useRef<HTMLDivElement>(null);\n\tconst draggableBlockElemRef = useRef<HTMLElement | null>(null);\n\n\tconst handleElementChanged = useCallback((element: HTMLElement | null) => {\n\t\tdraggableBlockElemRef.current = element;\n\t}, []);\n\n\tconst isOnMenu = useCallback((element: HTMLElement): boolean => {\n\t\treturn !!menuRef.current?.contains(element);\n\t}, []);\n\n\treturn (\n\t\t<>\n\t\t\t<DraggableBlockPlugin_EXPERIMENTAL\n\t\t\t\tanchorElem={anchorElem}\n\t\t\t\tmenuRef={menuRef}\n\t\t\t\ttargetLineRef={targetLineRef}\n\t\t\t\tonElementChanged={handleElementChanged}\n\t\t\t\tmenuComponent={\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={menuRef}\n\t\t\t\t\t\tclassName=\"group flex items-center gap-0.5 rounded p-0.5 px-px opacity-0 absolute left-0 top-0 will-change-transform\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclassName=\"flex items-center justify-center w-6 h-6 p-0 border-none bg-transparent cursor-pointer opacity-30 rounded group-hover:opacity-60 hover:opacity-100! hover:bg-neutral-200\"\n\t\t\t\t\t\t\taria-label=\"Add block\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Plus size={18} />\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<div className=\"flex items-center justify-center w-6 h-6 opacity-30 cursor-grab active:cursor-grabbing rounded group-hover:opacity-60 hover:opacity-100! hover:bg-neutral-200\">\n\t\t\t\t\t\t\t<GripVertical size={18} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t}\n\t\t\t\ttargetLineComponent={\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={targetLineRef}\n\t\t\t\t\t\tclassName=\"ib-block-control-target-line pointer-events-none bg-sky-400 h-1 absolute left-0 top-0 opacity-0 will-change-transform\"\n\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t\tisOnMenu={isOnMenu}\n\t\t\t/>\n\t\t</>\n\t);\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/hooks/use-editor-toolbar.ts",
      "content": "import {\n\t$getSelection,\n\t$isParagraphNode,\n\t$isRangeSelection,\n\t$isTextNode,\n\tgetDOMSelection,\n\tLexicalEditor,\n} from 'lexical';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { mergeRegister } from '@lexical/utils';\nimport { getSelectedNode } from '../lib/editor-utils';\n\nexport type EditorToolbarState = {\n\tisVisible: boolean;\n\tisBold: boolean;\n\tisItalic: boolean;\n\tisUnderline: boolean;\n\tisUppercase: boolean;\n\tisLowercase: boolean;\n\tisCapitalize: boolean;\n\tisStrikethrough: boolean;\n\tisSubscript: boolean;\n\tisSuperscript: boolean;\n};\n\nconst DEFAULT_STATE: EditorToolbarState = {\n\tisVisible: false,\n\tisBold: false,\n\tisItalic: false,\n\tisUnderline: false,\n\tisUppercase: false,\n\tisLowercase: false,\n\tisCapitalize: false,\n\tisStrikethrough: false,\n\tisSubscript: false,\n\tisSuperscript: false,\n};\n\nexport function useEditorToolbar(editor: LexicalEditor): EditorToolbarState {\n\tconst [toolbarState, setEditorToolbarState] =\n\t\tuseState<EditorToolbarState>(DEFAULT_STATE);\n\tconst isMouseDownRef = useRef(false);\n\n\tconst update = useCallback(\n\t\t(forceShow = false) => {\n\t\t\teditor.getEditorState().read(() => {\n\t\t\t\tif (editor.isComposing()) return;\n\n\t\t\t\t// Don't show toolbar while mouse is down (still selecting)\n\t\t\t\tif (isMouseDownRef.current && !forceShow) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst selection = $getSelection();\n\t\t\t\tconst nativeSelection = getDOMSelection(editor._window);\n\t\t\t\tconst rootElement = editor.getRootElement();\n\n\t\t\t\tif (\n\t\t\t\t\tnativeSelection !== null &&\n\t\t\t\t\t(!$isRangeSelection(selection) ||\n\t\t\t\t\t\trootElement === null ||\n\t\t\t\t\t\t!rootElement.contains(nativeSelection.anchorNode))\n\t\t\t\t) {\n\t\t\t\t\tsetEditorToolbarState(DEFAULT_STATE);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!$isRangeSelection(selection)) return;\n\n\t\t\t\tconst node = getSelectedNode(selection);\n\n\t\t\t\tconst hasText = selection.getTextContent() !== '';\n\t\t\t\tconst isText =\n\t\t\t\t\thasText && ($isTextNode(node) || $isParagraphNode(node));\n\n\t\t\t\tconst rawTextContent = selection\n\t\t\t\t\t.getTextContent()\n\t\t\t\t\t.replace(/\\n/g, '');\n\t\t\t\tconst isCollapsedWhitespaceSelection =\n\t\t\t\t\t!selection.isCollapsed() && rawTextContent === '';\n\n\t\t\t\tif (!isText || isCollapsedWhitespaceSelection) {\n\t\t\t\t\tsetEditorToolbarState(DEFAULT_STATE);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsetEditorToolbarState({\n\t\t\t\t\tisVisible: true,\n\t\t\t\t\tisBold: selection.hasFormat('bold'),\n\t\t\t\t\tisItalic: selection.hasFormat('italic'),\n\t\t\t\t\tisUnderline: selection.hasFormat('underline'),\n\t\t\t\t\tisUppercase: selection.hasFormat('uppercase'),\n\t\t\t\t\tisLowercase: selection.hasFormat('lowercase'),\n\t\t\t\t\tisCapitalize: selection.hasFormat('capitalize'),\n\t\t\t\t\tisStrikethrough: selection.hasFormat('strikethrough'),\n\t\t\t\t\tisSubscript: selection.hasFormat('subscript'),\n\t\t\t\t\tisSuperscript: selection.hasFormat('superscript'),\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t[editor],\n\t);\n\n\tuseEffect(() => {\n\t\tconst rootElement = editor.getRootElement();\n\t\tif (!rootElement) return;\n\n\t\tconst handleMouseDown = () => {\n\t\t\tisMouseDownRef.current = true;\n\t\t\t// Hide toolbar when starting a new selection\n\t\t\tsetEditorToolbarState(DEFAULT_STATE);\n\t\t};\n\n\t\tconst handleMouseUp = () => {\n\t\t\tisMouseDownRef.current = false;\n\t\t\t// Show toolbar after mouse is released\n\t\t\tupdate(true);\n\t\t};\n\n\t\trootElement.addEventListener('mousedown', handleMouseDown);\n\t\tdocument.addEventListener('mouseup', handleMouseUp);\n\n\t\treturn () => {\n\t\t\trootElement.removeEventListener('mousedown', handleMouseDown);\n\t\t\tdocument.removeEventListener('mouseup', handleMouseUp);\n\t\t};\n\t}, [editor, update]);\n\n\tuseEffect(() => {\n\t\tdocument.addEventListener('selectionchange', () => update());\n\t\treturn () =>\n\t\t\tdocument.removeEventListener('selectionchange', () => update());\n\t}, [update]);\n\n\tuseEffect(() => {\n\t\treturn mergeRegister(\n\t\t\teditor.registerUpdateListener(() => update()),\n\t\t\teditor.registerRootListener(() => {\n\t\t\t\tif (editor.getRootElement() === null) {\n\t\t\t\t\tsetEditorToolbarState(DEFAULT_STATE);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}, [editor, update]);\n\n\treturn toolbarState;\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "registry/lib/editor-utils.ts",
      "content": "import { $isAtNodeEnd } from '@lexical/selection';\nimport { ElementNode, RangeSelection, TextNode } from 'lexical';\n\nconst VERTICAL_GAP = 10;\nconst HORIZONTAL_OFFSET = 5;\n\nexport function setFloatingElemPosition(\n\ttargetRect: DOMRect | null,\n\tfloatingElem: HTMLElement,\n\tanchorElem: HTMLElement,\n\tisLink: boolean = false,\n\tverticalGap: number = VERTICAL_GAP,\n\thorizontalOffset: number = HORIZONTAL_OFFSET,\n): void {\n\tconst scrollerElem = anchorElem.parentElement;\n\n\tif (targetRect === null || !scrollerElem) {\n\t\tfloatingElem.style.opacity = '0';\n\t\tfloatingElem.style.top = '-10000px';\n\t\tfloatingElem.style.left = '-10000px';\n\t\treturn;\n\t}\n\n\tconst floatingElemRect = floatingElem.getBoundingClientRect();\n\tconst anchorElementRect = anchorElem.getBoundingClientRect();\n\tconst editorScrollerRect = scrollerElem.getBoundingClientRect();\n\n\tlet top = targetRect.top - floatingElemRect.height - verticalGap;\n\tlet left = targetRect.left - horizontalOffset;\n\n\tconst selection = window.getSelection();\n\tif (selection && selection.rangeCount > 0) {\n\t\tconst range = selection.getRangeAt(0);\n\t\tconst textNode = range.startContainer;\n\t\tif (textNode.nodeType === Node.ELEMENT_NODE || textNode.parentElement) {\n\t\t\tconst textElement =\n\t\t\t\ttextNode.nodeType === Node.ELEMENT_NODE\n\t\t\t\t\t? (textNode as Element)\n\t\t\t\t\t: (textNode.parentElement as Element);\n\t\t\tconst textAlign = window.getComputedStyle(textElement).textAlign;\n\n\t\t\tif (textAlign === 'right' || textAlign === 'end') {\n\t\t\t\tleft =\n\t\t\t\t\ttargetRect.right -\n\t\t\t\t\tfloatingElemRect.width +\n\t\t\t\t\thorizontalOffset;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (top < editorScrollerRect.top) {\n\t\ttop +=\n\t\t\tfloatingElemRect.height +\n\t\t\ttargetRect.height +\n\t\t\tverticalGap * (isLink ? 9 : 2);\n\t}\n\n\tif (left + floatingElemRect.width > editorScrollerRect.right) {\n\t\tleft =\n\t\t\teditorScrollerRect.right -\n\t\t\tfloatingElemRect.width -\n\t\t\thorizontalOffset;\n\t}\n\n\tif (left < editorScrollerRect.left) {\n\t\tleft = editorScrollerRect.left + horizontalOffset;\n\t}\n\n\ttop -= anchorElementRect.top;\n\tleft -= anchorElementRect.left;\n\n\tfloatingElem.style.opacity = '1';\n\tfloatingElem.style.top = `${top}px`;\n\tfloatingElem.style.left = `${left}px`;\n}\n\nexport function getSelectedNode(\n\tselection: RangeSelection,\n): TextNode | ElementNode {\n\tconst anchor = selection.anchor;\n\tconst focus = selection.focus;\n\tconst anchorNode = selection.anchor.getNode();\n\tconst focusNode = selection.focus.getNode();\n\tif (anchorNode === focusNode) {\n\t\treturn anchorNode;\n\t}\n\tconst isBackward = selection.isBackward();\n\tif (isBackward) {\n\t\treturn $isAtNodeEnd(focus) ? anchorNode : focusNode;\n\t} else {\n\t\treturn $isAtNodeEnd(anchor) ? anchorNode : focusNode;\n\t}\n}\n\nexport function getDOMRangeRect(\n\tnativeSelection: Selection,\n\trootElement: HTMLElement,\n): DOMRect {\n\tconst domRange = nativeSelection.getRangeAt(0);\n\n\tlet rect;\n\n\tif (nativeSelection.anchorNode === rootElement) {\n\t\tlet inner = rootElement;\n\t\twhile (inner.firstElementChild != null) {\n\t\t\tinner = inner.firstElementChild as HTMLElement;\n\t\t}\n\t\trect = inner.getBoundingClientRect();\n\t} else {\n\t\trect = domRange.getBoundingClientRect();\n\t}\n\n\treturn rect;\n}\n",
      "type": "registry:lib"
    }
  ],
  "type": "registry:block"
}